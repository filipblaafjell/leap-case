version: 2

sources:
  - name: raw_fred
    database: LEAP_STAGING
    schema: RAW
    tables:
      - name: FRED_MACRO_RAW

models:
  - name: stg_fred_macro
    description: >
      Cleans and standardizes macroeconomic indicators from the FRED dataset,
      including CPI, income, consumption, savings rate, interest rates, and sentiment.
    columns:
      - name: date
        description: "Observation date for each macroeconomic indicator."
        tests:
          - not_null
          - unique

      - name: avg_hourly_earnings
        description: "Average hourly earnings of employees (CES0500000003)."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ avg_hourly_earnings }} > 0"

      - name: cpi_all_items
        description: "Consumer Price Index for all items (CPIAUCSL)."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ cpi_all_items }} > 0"

      - name: food_price_index
        description: "Food price index (CUSR0000SAF11)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ food_price_index }} > 0"

      - name: gasoline_price_index
        description: "Gasoline price index (CUSR0000SETB01)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ gasoline_price_index }} > 0"

      - name: ecom_sales
        description: "E-commerce retail sales (ECOMNSA)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ ecom_sales }} > 0"

      - name: fed_funds_rate
        description: "Federal funds rate (FEDFUNDS)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ fed_funds_rate }} between 0 and 20"

      - name: job_openings
        description: "Job openings (JTSJOL)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ job_openings }} >= 0"

      - name: personal_consumption
        description: "Personal consumption expenditures (PCE)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ personal_consumption }} > 0"

      - name: personal_income
        description: "Personal income (PI)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ personal_income }} > 0"

      - name: personal_saving_rate
        description: "Personal saving rate (PSAVERT)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ personal_saving_rate }} between 0 and 100"

      - name: credit_card_debt
        description: "Revolving consumer credit (REVOLSL)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ credit_card_debt }} >= 0"

      - name: retail_sales
        description: "Retail sales (RSAFS)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ retail_sales }} > 0"

      - name: consumer_sentiment
        description: "University of Michigan consumer sentiment index (UMCSENT)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "{{ consumer_sentiment }} between 0 and 200"
